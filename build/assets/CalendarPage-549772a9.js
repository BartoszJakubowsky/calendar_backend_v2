import{r as p,j as e,A as S,a as v,F as $,S as P,u as M,t as k,b as E,c as F,g as U,M as z,C as _,L as A}from"./index-8b68bf4b.js";function H({modalText:n,buttonText:r,onClick:l,isOpen:i,setIsOpen:c,onlyButton:d=!0}){const u={type:"spring",stiffness:700,damping:30};p.useEffect(()=>{const a=o=>{o.keyCode===27&&s()};return window.addEventListener("keydown",a),()=>{window.removeEventListener("keydown",a)}},[]);const f=()=>{l&&l(),c(!1)},s=()=>{d||c(!1)};return e.jsx(S,{mode:"wait",children:i?e.jsx(v,{onClick:s,animation:"opacityVariant",transition:{duration:.2},className:"!fixed inset-0 bg-opacity-80 duration-200 transition-all bg-gray-900 z-50 flex justify-center items-center",children:e.jsxs(v,{transition:u,animation:"scaleVariant",className:"relative w-80 rounded-sm h-60 bg-red-100 mb-3/4 background p-4 overflow-hidden text-lg flex flex-wrap flex-col",children:[n,e.jsx($,{onClick:f,text:r,className:"!w-fit !self-end mt-auto mb-2"})]})}):!1})}function I({days:n,bannedData:r,rowClassName:l,cellClassName:i,additionalFirstCol:c,translate:d,isPastDate:u}){const f=n.filter(a=>!r.includes(a.name.toUpperCase())),s=f.length>0?f.map(a=>{if(a.erase||u(a.date)||(t=>{const h=t.toUpperCase();return r.includes(h)})(a.name))return!1;const x=a.date.split("T")[0].split("-").reverse().join("-");return e.jsxs("th",{className:`${i} flex flex-col grow bg-accentMedium dark:bg-dark-accentMedium text-dark-baseColor dark:text-baseColor font-medium`,children:[e.jsx("h3",{className:"pb-1",children:d(a.name)}),e.jsx("h4",{children:x}),e.jsx("div",{className:"flex justify-evenly w-full overflow-hidden",children:a.columns.map(t=>e.jsx("h4",{className:"h-14 w-16 text-sm text-center",children:t.name},t.id))})]},a.id)}):!1;return e.jsx(e.Fragment,{children:s&&s.some(a=>a!==!1)?e.jsxs("tr",{className:`${l} sticky top-0 z-[6]`,children:[c?e.jsx("th",{className:`${i}  sticky -left-[1px] w-16  bg-accentLight dark:bg-dark-accentLight text-dark-baseColor dark:text-baseColor`,children:d(c)}):!1,s]}):!1})}function V(){return p.useContext(P)}function O({record:n,translate:r,calendarId:l,date:i,time:c}){const{user:d}=M(),{socket:u,updateRecord:f}=V(),[s,a]=p.useState(n.data),o=n.id,[x,t]=p.useState(!1),h=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],g=new Date(i),m=h[g.getUTCDay()],j=()=>{const w=g.getUTCDate().toString().padStart(2,"0"),T=(g.getUTCMonth()+1).toString().padStart(2,"0"),L=g.getUTCFullYear();return`${w}-${T}-${L}`},b=w=>{w.recordId===o&&a(w.data)};p.useEffect(()=>{u&&u.on("sign",w=>b(w))},[]);const C=()=>{t(r(s===""?"sign":"sign_out"))},y=()=>{t(!1)},D=()=>{f({recordId:o,calendarId:l,data:s===""?d.name:"",userId:d._id,date:{fullDate:j(),dayName:m,time:c}}),s===""?t(!1):C()};return e.jsx(e.Fragment,{children:e.jsx("button",{className:`${s===""?"dark:bg-dark-accentLight bg-accentLight ":"bg-accentMedium dark:bg-dark-accentMedium"}
         hover:bg-accentMedium dark:hover:bg-dark-accentStrongHover  w-24 h-14 hover:shadow-lg transition-all active:bg-accentStrong dark:active:bg-dark-accentStrong active:text-baseColor duration-200 grow rounded-sm border-[1px] border-slate-700 m-1 overflow-hidden`,onMouseEnter:C,onMouseLeave:y,onClick:D,children:x||s})})}function N({message:n,hide:r,...l}){if(r)return!1;const i=n.data,c=n.date,d=n.time;function u(s){const a=new Date("2023-08-31T22:00:00.000Z"),o=new Date(s);if(d){const[x,t]=d.split(":");o.inputDateTime.setUTCHours(x,t,0,0)}return o<a}return i==""||c&&u(c)?!1:e.jsx("div",{className:`${l.className?l.className:""} z-[1] inset-0 absolute flex justify-center items-center bg-accentMedium dark:bg-dark-accentMedium dark:text-baseColor rounded-md border-2 border-accentStrong dark:border-dark-accentStrong`,children:e.jsx("p",{className:`${l.className?"":"sticky top-1/4 bottom-1/2 left-1/4 right-1/4 "} text-center`,children:i})})}function B({days:n,bannedDays:r,rowClassName:l,cellClassName:i,time:c,translate:d,index:u,calendarId:f,weekMessage:s,isPastDate:a}){const o=(m,j)=>m.map(b=>e.jsx(O,{record:b,translate:d,calendarId:f,date:j,time:c},b.id)),x=(m,j)=>{const b=m.map((C,y)=>{if(y===u)return e.jsx("div",{className:"flex flex-col items-center justify-center relative grow ",children:o(C.records,j)},C.id)});return e.jsx(e.Fragment,{children:b})},t=(m,j)=>m.map(b=>e.jsxs("div",{className:"flex relative grow",children:[b.messages.length>0&&e.jsx(N,{className:"flex z-[2]",message:b.messages[0],isVisible:s}),x(b.slots,j)]},b.id)),h=n.filter(m=>!r.includes(m.name.toUpperCase())),g=h.length>0?h.map(m=>m.erase||a(m.date)?!1:e.jsxs("td",{className:`${i} flex flex-row grow relative`,children:[m.messages.length>0&&e.jsx(N,{className:"flex z-[3]",message:m.messages[0],hide:s}),t(m.columns,m.date)]},m.id)):!1;return e.jsx(e.Fragment,{children:g&&g.some(m=>m!==!1)?e.jsxs("tr",{className:`${l} relative`,children:[e.jsx("td",{className:`${i}border-l-0 border-r-2 sticky z-[5] -left-[1px] w-16 bg-accentLight dark:bg-dark-accentLight text-dark-baseColor dark:text-baseColor justify-center flex items-center`,children:e.jsx("span",{className:"sticky top-28",children:c})}),g]}):!1})}function R({week:n,calendarId:r}){const{days:l,bannedDays:i,time:c,messages:d,erase:u}=n,f=s=>{const a=new Date;return new Date(s)<a};return u?!1:e.jsxs("table",{className:"relative",children:[d.length>0&&e.jsx(N,{message:d[0]}),e.jsxs("tbody",{children:[e.jsx(I,{rowClassName:"flex flex-row",cellClassName:"bg-accentLight dark:bg-accentLight border-2 border-slate-700",days:l,bannedData:i,additionalFirstCol:"time",translate:k,isPastDate:f}),c.map((s,a)=>e.jsx(B,{index:a,rowClassName:"flex flex-row",cellClassName:"bg-accentLight dark:bg-dark-accentLight border-2 border-slate-700 text-dark-baseColor dark:text-baseColor",days:l,bannedDays:i,time:s,translate:k,calendarId:r,weekMessage:d.length>0,isPastDate:f},s))]})]})}function J({month:n,swipe:r,setSwipe:l,maxIndex:i,calendarId:c}){const[d,u]=n.name.split(".").map(x=>x.toLowerCase()),f=n.messages.map((x,t)=>e.jsx(N,{message:x},t)),s=()=>{l(r-1)},a=()=>{l(r+1)},o=n.weeks.map((x,t)=>e.jsx(R,{week:x,calendarId:c},t));return e.jsxs("div",{className:"overflow-hidden w-full h-full border-2 border-slate-700",children:[f,e.jsxs("div",{className:"relative text-lg w-full md:h-[4%] h-[10%] text-center bg-accentStrongHover dark:bg-dark-accentStrongHover text-baseColor dark:text-baseColor",children:[e.jsx("h3",{className:"w-full",children:k(u)}),e.jsx("button",{onClick:s,className:`absolute text-sm left-1 bottom-1 md:top-1 transition-all duration-200 ${r===0?" opacity-50 pointer-events-none":""}`,children:k("previousMonth")}),e.jsx("button",{onClick:a,className:`absolute text-sm right-1 bottom-1 md:top-1 transition-all duration-200 ${r===i?"opacity-50 pointer-events-none":""}`,children:k("nextMonth")})]}),e.jsx("div",{className:"flex flex-wrap flex-col md:h-[96%] h-[95%] w-full overflow-auto touch-auto",children:o})]})}function K(){const n=E(),r=F(),{isAdmin:l}=M(),i=n.pathname.split("/").pop(),[c,d]=p.useState(0),[u,f]=p.useState(!1),s=t=>{const h=g=>JSON.parse(JSON.stringify(g.replaceAll(" ","_").normalize("NFD").replace(/[\u0300-\u036f]/g,"")));for(let g=0;g<t.length;g++)if(h(t[g].name)===h(i))return t[g];return!1},a=p.useMemo(()=>{const t=n.state;if(t){const h=s([t]);return h||!1}else return!1},[]),[o,x]=p.useState(a);return p.useEffect(()=>(o||U().then(t=>{const h=s(t);if(h){x(h);return}else setTimeout(()=>{r("/brak_strony",{state:n.pathname})},500)}),()=>{window.history.replaceState({},document.title)}),[]),e.jsx(e.Fragment,{children:e.jsx(v,{className:" background flex justify-center items-start overflow-hidden flex-wrap",animation:"opacityVariant",children:e.jsxs(S,{mode:"wait",children:[e.jsx(H,{isOpen:o.conservation&&!l?!0:u,modalText:k("modalTextConservation"),buttonText:k("modalButtonText"),setIsOpen:f,onClick:()=>r("/")}),e.jsx(z,{}),o?e.jsx(e.Fragment,{children:e.jsxs(v,{className:"w-full h-full flex justify-center flex-wrap",animation:"opacityVariant",children:[e.jsx("h3",{className:"custom-text-accentStrong text-center text-xl w-full underline font-bold md:pt-4 pt-4 pointer-events-none",children:o.name}),e.jsx(_,{className:"w-11/12 max-w-fit md:w-3/4 h-5/6 md:h-3/4 md:-mt-28 -mt-4 rounded-sm relative",containerClassName:"w-full h-full bg-accentMedium dark:bg-dark-accentMedium flex justify-stretch",startPosition:0,pages:o.months.map(t=>e.jsx(J,{month:t,calendarId:o._id,swipe:c,maxIndex:o.months.length-1,setSwipe:d},t._id)),swipeToIndex:c},"carosuel")]},"calendarPage")}):e.jsx(A,{message:k("loading"),theme:"text-accentStrong dark:text-dark-accentStrong ",className:" self-center"})]})},"calendarPageContainer")})}export{K as default};
