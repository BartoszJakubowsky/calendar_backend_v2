import{r as b,j as e,A as S,a as v,F as E,S as P,u as M,t as j,b as F,c as I,g as U,M as _,C as z,L as A}from"./index-0dadbc73.js";function H({modalText:n,buttonText:r,onClick:o,isOpen:l,setIsOpen:d,onlyButton:c=!0}){const h={type:"spring",stiffness:700,damping:30};b.useEffect(()=>{const a=g=>{g.keyCode===27&&s()};return window.addEventListener("keydown",a),()=>{window.removeEventListener("keydown",a)}},[]);const u=()=>{o&&o(),d(!1)},s=()=>{c||d(!1)};return e.jsx(S,{mode:"wait",children:l?e.jsx(v,{onClick:s,animation:"opacityVariant",transition:{duration:.2},className:"!fixed inset-0 bg-opacity-80 duration-200 transition-all bg-gray-900 z-50 flex justify-center items-center",children:e.jsxs(v,{transition:h,animation:"scaleVariant",className:"relative w-80 rounded-sm h-60 bg-red-100 mb-3/4 background p-4 overflow-hidden text-lg flex flex-wrap flex-col",children:[n,e.jsx(E,{onClick:u,text:r,className:"!w-fit !self-end mt-auto mb-2"})]})}):!1})}function V({days:n,bannedData:r,rowClassName:o,cellClassName:l,additionalFirstCol:d,translate:c,isPastDate:h}){const u=n.filter(a=>!r.includes(a.name.toUpperCase())),s=u.length>0?u.map(a=>{if(a.erase||h(a.date)||(i=>{const p=i.toUpperCase();return r.includes(p)})(a.name))return!1;const f=a.date.split("T")[0].split("-").reverse().join("-");return e.jsxs("th",{className:`${l} flex flex-col grow bg-accentMedium dark:bg-dark-accentMedium text-dark-baseColor dark:text-baseColor font-medium`,children:[e.jsx("h3",{className:"pb-1",children:c(a.name)}),e.jsx("h4",{children:f}),e.jsx("div",{className:"flex justify-evenly w-full overflow-hidden",children:a.columns.map(i=>e.jsx("h4",{className:"h-14 w-16 text-sm text-center",children:i.name},i.id))})]},a.id)}):!1;return e.jsx(e.Fragment,{children:s&&s.some(a=>a!==!1)?e.jsxs("tr",{className:`${o} sticky top-0 z-[6]`,children:[d?e.jsx("th",{className:`${l}  sticky -left-[1px] w-16  bg-accentLight dark:bg-dark-accentLight text-dark-baseColor dark:text-baseColor`,children:c(d)}):!1,s]}):!1})}function D(){return b.useContext(P)}function O({record:n,translate:r,calendarId:o,date:l,time:d}){const{user:c}=M(),{socket:h,updateRecord:u}=D(),[s,a]=b.useState(n.data),g=n.id,[f,i]=b.useState(!1),p=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],k=new Date(l),t=p[k.getUTCDay()],x=()=>{const w=k.getUTCDate().toString().padStart(2,"0"),L=(k.getUTCMonth()+1).toString().padStart(2,"0"),$=k.getUTCFullYear();return`${w}-${L}-${$}`},m=w=>{w.recordId===g&&a(w.data)};b.useEffect(()=>{h&&h.on("sign",w=>m(w))},[]);const C=()=>{i(r(s===""?"sign":"sign_out"))},y=()=>{i(!1)},T=()=>{u({recordId:g,calendarId:o,data:s===""?c.name:"",userId:c._id,date:{fullDate:x(),dayName:t,time:d}}),s===""?i(!1):C()};return e.jsx(e.Fragment,{children:e.jsx("button",{className:`${s===""?"dark:bg-dark-accentLight bg-accentLight ":"bg-accentMedium dark:bg-dark-accentMedium"}
         hover:bg-accentMedium dark:hover:bg-dark-accentStrongHover  w-24 h-14 hover:shadow-lg transition-all active:bg-accentStrong dark:active:bg-dark-accentStrong active:text-baseColor duration-200 grow rounded-sm border-[1px] border-slate-700 m-1 overflow-hidden`,onMouseEnter:C,onMouseLeave:y,onClick:T,children:f||s})})}function N({message:n,hide:r,...o}){if(r)return!1;const l=n.data,d=n.date,c=n.time;function h(s){const a=new Date("2023-08-31T22:00:00.000Z"),g=new Date(s);if(c){const[f,i]=c.split(":");g.inputDateTime.setUTCHours(f,i,0,0)}return g<a}return l==""||d&&h(d)?!1:e.jsx("div",{className:`${o.className?o.className:""} z-[1] inset-0 absolute flex justify-center items-center bg-accentMedium dark:bg-dark-accentMedium dark:text-baseColor rounded-md border-2 border-accentStrong dark:border-dark-accentStrong`,children:e.jsx("p",{className:`${o.className?"":"sticky top-1/4 bottom-1/2 left-1/4 right-1/4 "} text-center`,children:l})})}function B({days:n,bannedDays:r,rowClassName:o,cellClassName:l,time:d,translate:c,index:h,calendarId:u,weekMessage:s,isPastDate:a}){const g=(t,x)=>t.map(m=>e.jsx(O,{record:m,translate:c,calendarId:u,date:x,time:d},m.id)),f=(t,x)=>{const m=t.map((C,y)=>{if(y===h)return e.jsx("div",{className:"flex flex-col items-center justify-center relative grow ",children:g(C.records,x)},C.id)});return e.jsx(e.Fragment,{children:m})},i=(t,x)=>t.map(m=>e.jsxs("div",{className:"flex relative grow",children:[m.messages.length>0&&e.jsx(N,{className:"flex z-[2]",message:m.messages[0],isVisible:s}),f(m.slots,x)]},m.id)),p=n.filter(t=>!r.includes(t.name.toUpperCase())),k=p.length>0?p.map(t=>t.erase||a(t.date)?!1:e.jsxs("td",{className:`${l} flex flex-row grow relative`,children:[t.messages.length>0&&e.jsx(N,{className:"flex z-[3]",message:t.messages[0],hide:s}),i(t.columns,t.date)]},t.id)):!1;return e.jsx(e.Fragment,{children:k&&k.some(t=>t!==!1)?e.jsxs("tr",{className:`${o} relative`,children:[e.jsx("td",{className:`${l}border-l-0 border-r-2 sticky z-[5] -left-[1px] w-16 bg-accentLight dark:bg-dark-accentLight text-dark-baseColor dark:text-baseColor justify-center flex items-center`,children:e.jsx("span",{className:"sticky top-28",children:d})}),k]}):!1})}function R({week:n,calendarId:r}){const{days:o,bannedDays:l,time:d,messages:c,erase:h}=n,u=s=>{const a=new Date;return new Date(s)<a};return h?!1:e.jsxs("table",{className:"relative",children:[c.length>0&&e.jsx(N,{message:c[0]}),e.jsxs("tbody",{children:[e.jsx(V,{rowClassName:"flex flex-row",cellClassName:"bg-accentLight dark:bg-accentLight border-2 border-slate-700",days:o,bannedData:l,additionalFirstCol:"time",translate:j,isPastDate:u}),d.map((s,a)=>e.jsx(B,{index:a,rowClassName:"flex flex-row",cellClassName:"bg-accentLight dark:bg-dark-accentLight border-2 border-slate-700 text-dark-baseColor dark:text-baseColor",days:o,bannedDays:l,time:s,translate:j,calendarId:r,weekMessage:c.length>0,isPastDate:u},s))]})]})}function J({month:n,swipe:r,setSwipe:o,maxIndex:l,calendarId:d}){const[c,h]=n.name.split(".").map(f=>f.toLowerCase()),u=n.messages.map((f,i)=>e.jsx(N,{message:f},i)),s=()=>{o(r-1)},a=()=>{o(r+1)},g=n.weeks.map((f,i)=>e.jsx(R,{week:f,calendarId:d},i));return e.jsxs("div",{className:"overflow-hidden w-full h-full border-2 border-slate-700",children:[u,e.jsxs("div",{className:"relative text-lg w-full md:h-[4%] h-[10%] text-center bg-accentStrongHover dark:bg-dark-accentStrongHover text-baseColor dark:text-baseColor",children:[e.jsx("h3",{className:"w-full",children:j(h)}),e.jsx("button",{onClick:s,className:`absolute text-sm left-1 bottom-1 md:top-1 transition-all duration-200 ${r===0?" opacity-50 pointer-events-none":""}`,children:j("previousMonth")}),e.jsx("button",{onClick:a,className:`absolute text-sm right-1 bottom-1 md:top-1 transition-all duration-200 ${r===l?"opacity-50 pointer-events-none":""}`,children:j("nextMonth")})]}),e.jsx("div",{className:"flex flex-wrap flex-col md:h-[96%] h-[95%] w-full overflow-auto touch-auto",children:g})]})}function K(){const n=F(),r=I(),{isAdmin:o}=M(),{socket:l,setConservation:d,compareSocketId:c}=D(),h=n.pathname.split("/").pop(),[u,s]=b.useState(0),[a,g]=b.useState(!1),f=t=>{const x=m=>JSON.parse(JSON.stringify(m.replaceAll(" ","_").normalize("NFD").replace(/[\u0300-\u036f]/g,"")));for(let m=0;m<t.length;m++)if(x(t[m].name)===x(h))return t[m];return!1},i=b.useMemo(()=>{const t=n.state;if(t){const x=f([t]);return x||!1}else return!1},[]),[p,k]=b.useState(i);return b.useEffect(()=>(p||U().then(t=>{const x=f(t);if(x){k(x);return}else setTimeout(()=>{r("/brak_strony",{state:n.pathname})},500)}),()=>{window.history.replaceState({},document.title)}),[]),b.useEffect(()=>{l&&l.on("conservation",t=>{t.calendarId===p._id&&!c(t.senderId)&&g(!0)})},[]),e.jsx(e.Fragment,{children:e.jsx(v,{className:" background flex justify-center items-start overflow-hidden flex-wrap",animation:"opacityVariant",children:e.jsxs(S,{mode:"wait",children:[e.jsx(H,{isOpen:p.conservation&&!o?!0:a,modalText:j("modalTextConservation"),buttonText:j("modalButtonText"),setIsOpen:g,onClick:()=>r("/")}),e.jsx(_,{}),p?e.jsx(e.Fragment,{children:e.jsxs(v,{className:"w-full h-full flex justify-center flex-wrap",animation:"opacityVariant",children:[e.jsx("h3",{className:"custom-text-accentStrong text-center text-xl w-full underline font-bold md:pt-4 pt-4 pointer-events-none",children:p.name}),e.jsx(z,{className:"w-11/12 max-w-fit md:w-3/4 h-5/6 md:h-3/4 md:-mt-28 -mt-4 rounded-sm relative",containerClassName:"w-full h-full bg-accentMedium dark:bg-dark-accentMedium flex justify-stretch",startPosition:0,pages:p.months.map((t,x)=>e.jsx(J,{month:t,calendarId:p._id,swipe:u,maxIndex:p.months.length-1,setSwipe:s},t._id)),swipeToIndex:u},"carosuel")]},"calendarPage")}):e.jsx(A,{message:j("loading"),theme:"text-accentStrong dark:text-dark-accentStrong ",className:" self-center"})]})},"calendarPageContainer")})}export{K as default};
